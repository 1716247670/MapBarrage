(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-264bc296"],{"8ce5":function(t,e,n){},9406:function(t,e,n){"use strict";n.r(e);var a,o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-card",{staticClass:"danmu-control-pannel",attrs:{shadow:"hover"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[t._v("弹幕操作")])]),n("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:t.playDanmu}},[t._v("播放")]),n("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:t.pauseDanmu}},[t._v("暂停")]),n("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:t.hideDanmu}},[t._v("隐藏")]),n("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:t.showDanmu}},[t._v("显示")])],1),n("el-card",{staticClass:"layer-control-pannel",attrs:{shadow:"hover"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[t._v("图层操作")])]),n("el-form",{attrs:{"label-width":"80px",size:"mini"}},[n("el-form-item",{attrs:{label:"轨道图层"}},[n("el-switch",{on:{change:t.toggleGridLayer},model:{value:t.gridLayerShow,callback:function(e){t.gridLayerShow=e},expression:"gridLayerShow"}})],1),n("el-form-item",{attrs:{label:"POI图层"}},[n("el-select",{on:{change:t.selectPOILayer},model:{value:t.currentLayer,callback:function(e){t.currentLayer=e},expression:"currentLayer"}},[n("el-option",{attrs:{label:"旅游景点",value:"scene"}}),n("el-option",{attrs:{label:"美食餐饮",value:"food"}}),n("el-option",{attrs:{label:"休闲娱乐",value:"fun"}})],1)],1)],1)],1),t._l(t.danmus,(function(e,a){return[n("vue-danmaku",{ref:"danmaku",refInFor:!0,staticClass:"danmaku",style:{top:"calc((100vh - 50px)/8*"+a+")"},attrs:{loop:"","use-slot":"",channels:1,randomChannel:!1,speeds:200-5*e.content.length,isSuspend:""},scopedSlots:t._u([{key:"dm",fn:function(e){e.index;var a=e.danmu;return[a.name?n("div",{staticClass:"danmaku-name"},[n("wordcloud",{attrs:{mainWord:{text:a.name,weight:10+Math.ceil(10*(a.overall_rating-4))},keywordsList:a.tagList}})],1):t._e()]}}],null,!0),model:{value:e.content,callback:function(n){t.$set(e,"content",n)},expression:"danmu.content"}})]})),n("div",{attrs:{id:"map-container"}})],2)},r=[],i=n("2909"),c=n("c7eb"),s=n("1da1"),l=(n("4de4"),n("d81d"),n("fb6a"),n("4e82"),n("d3b7"),n("159b"),n("ac6d"),n("e192")),u=n.n(l),d=n("595b"),f=n("48c3"),p=n.n(f),h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"word-container"},t._l(t.fullList,(function(e,a){return n("div",{key:a,staticClass:"grid-item",class:{"main-word":e.main},style:{fontSize:t.fontSize(e.weight),color:t.color(e.weight)}},[e.text?n("span",[t._v(" "+t._s(e.text))]):t._e()])})),0)},m=[],y=n("5530"),b=(n("a434"),{name:"WordCloud",props:{mainWord:{type:Object,default:function(){return{text:"无",weight:10}}},keywordsList:{type:Array,default:function(){return[]}}},data:function(){return{colors:["#008fbf","#239fcf","#47b0df","#6ac0ef","#8dd0ff","#dae695","#ffb8b8","#df7b7b","#c03d3d","#a00000"]}},mounted:function(){},methods:{fontSize:function(t){return"".concat(12+1*t,"px")},color:function(t){return t-=1,t>this.colors.length-1&&(t=this.colors.length-1),this.colors[t]}},computed:{fullList:function(){var t=Object(i["a"])(this.keywordsList);return t.splice(5,0,Object(y["a"])(Object(y["a"])({},this.mainWord),{},{main:!0})),t}}}),g=b,v=(n("cbd8"),n("2877")),w=Object(v["a"])(g,h,m,!1,null,"f6c971fa",null),x=w.exports,k={name:"Dashboard",components:{vueDanmaku:p.a,wordcloud:x},computed:{},data:function(){return{danmus:[{content:["我是弹幕","好好好","嘿嘿嘿","哈哈哈"]},{content:["111","11","1","1"]},{content:["我是弹幕","好好好","嘿嘿嘿","哈哈哈"]},{content:["我是弹幕","好好好","嘿嘿嘿","哈哈哈"]},{content:["我是弹幕","好好好","嘿嘿嘿","哈哈哈"]},{content:["我是弹幕","好好好","嘿嘿嘿","哈哈哈"]},{content:["我是弹幕","好好好","嘿嘿嘿","哈哈哈"]},{content:["我是弹幕","好好好","嘿嘿嘿","哈哈哈"]}],gridLayerShow:!1,currentLayer:"food",dataPOI:{}}},mounted:function(){var t=this;function e(){if(t.stopDanmu(),t.playDanmu(),a.getSource("gridsource"))a.removeLayer("grid-layer"),a.removeSource("gridsource");else{for(var e=n(8),o=t.dataPOI,r=function(){var n=e.features[c],a=o.features.filter((function(t){return d["booleanPointInPolygon"](t,n.geometry)}));t.danmus[c].content=a.map((function(t){return t.properties}));var r=t.danmus[c].content;r.forEach((function(t){var e=[];t.overall_rating&&e.push({text:"评分:"+t.overall_rating,weight:10}),t.label&&t.label.split(",").forEach((function(t){e.push({text:t,weight:9})})),t.price&&e.push({text:"价格:"+t.price,weight:9}),t.keywords&&t.keywords.forEach((function(t){var n=Math.ceil(10*t[1]);n<1&&(n=1),n>10&&(n=10),e.push({text:t[0],weight:n})}));while(e.length<10)e.push({text:"",weight:1});e.sort((function(){return Math.random()-.5})),t.tagList=e.slice(0,10)})),n.properties.pointCount=parseInt(a.length)},c=0;c<e.features.length;c++)r();var s=Math.max.apply(Math,Object(i["a"])(e.features.map((function(t){return t.properties.pointCount})))),l=Math.min.apply(Math,Object(i["a"])(e.features.map((function(t){return t.properties.pointCount}))));a.addSource("gridsource",{type:"geojson",data:e}),a.addLayer({id:"grid-layer",type:"fill",source:"gridsource",paint:{"fill-color":["interpolate",["linear"],["get","pointCount"],l,"#008fbf",s,"#a00000"],"fill-opacity":.3}}),t.gridLayerShow?a.setLayoutProperty("grid-layer","visibility","visible"):a.setLayoutProperty("grid-layer","visibility","none")}}function n(t){for(var e=o(),n=e.lngMin,a=e.lngMax,r=e.latMin,i=e.latMax,c=[n,r,a,i],s=(c[3]-c[1])/t,l=[],u=0;u<t;u++){var f=c[1]+u*s,p=f+s,h=[c[0],f,c[2],p],m=d["bboxPolygon"](h);l.push(m)}var y=d["featureCollection"](l.reverse());return y}function o(){var t=a.getBounds(),e={lngMax:t._ne.wrap().lng,lngMin:t._sw.wrap().lng,latMax:t._ne.wrap().lat,latMin:t._sw.wrap().lat};return e}u.a.accessToken="pk.eyJ1IjoiemhvbmdkaXNodW1hIiwiYSI6ImNsNXJoYXR5eTI2bGgzZW53d2didWF1c3AifQ.6vOplM2NQc_xnJW3aA5ZBA",a=new u.a.Map({container:"map-container",style:"mapbox://styles/mapbox/streets-v12",center:[114.35400105,30.6512685],zoom:10,minZoom:10}),a.dragRotate.disable(),a.touchZoomRotate.disableRotation(),Object(s["a"])(Object(c["a"])().mark((function e(){return Object(c["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.createPoi(t.currentLayer);case 3:t.dataPOI=e.sent,console.log(t.dataPOI),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("Error loading data:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))(),a.on("load",(function(){e(),a.addSource("wuhanSource",{type:"geojson",data:t.dataPOI}),a.addLayer({id:"icons",type:"symbol",source:"wuhanSource",layout:{"icon-image":"restaurant","icon-size":1.5,"icon-allow-overlap":!0,"text-field":["get","name"],"text-size":12,"text-offset":[0,2],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-max-width":8},paint:{"text-color":"#000000","text-halo-color":"#ffffff","text-halo-width":1}})})),a.on("zoomend",(function(){console.log("zoomend"),e()})),a.on("moveend",(function(){console.log("moveend"),e()}))},methods:{hideDanmu:function(){this.$refs["danmaku"].forEach((function(t){return t.hide()}))},showDanmu:function(){this.$refs["danmaku"].forEach((function(t){return t.show()}))},pauseDanmu:function(){this.$refs["danmaku"].forEach((function(t){return t.pause()}))},stopDanmu:function(){this.$refs["danmaku"].forEach((function(t){return t.stop()}))},playDanmu:function(){this.$refs["danmaku"].forEach((function(t){return t.play()}))},toggleGridLayer:function(t){t?a.setLayoutProperty("grid-layer","visibility","visible"):a.setLayoutProperty("grid-layer","visibility","none")},selectPOILayer:function(t){var e,n=this;switch(this.stopDanmu(),t){case"scene":e="attraction";break;case"food":e="restaurant";break;case"fun":e="theatre";break;default:e="marker";break}Object(s["a"])(Object(c["a"])().mark((function o(){return Object(c["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,n.createPoi(t);case 3:n.dataPOI=o.sent,a.getSource("wuhanSource").setData(n.dataPOI),a.setLayoutProperty("icons","icon-image",e),console.log(n.dataPOI),o.next=12;break;case 9:o.prev=9,o.t0=o["catch"](0),console.error("Error loading data:",o.t0);case 12:case"end":return o.stop()}}),o,null,[[0,9]])})))()},createPoi:function(t){if("food"==t||"fun"==t||"scene"==t)return new Promise((function(e,n){fetch("./data/".concat(t,".json")).then((function(t){return t.json()})).then((function(t){var n=d["featureCollection"](t.features);e(n)})).catch((function(t){n(t)}))}))}}},L=k,O=(n("be18"),Object(v["a"])(L,o,r,!1,null,"a4391ace",null));e["default"]=O.exports},be18:function(t,e,n){"use strict";n("8ce5")},c6bb:function(t,e,n){},cbd8:function(t,e,n){"use strict";n("c6bb")}}]);